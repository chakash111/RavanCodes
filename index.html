<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravan Codes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="card">
        <div class="profile-img">
            <img src="https://i.ibb.co/HThZcKrd/file-00000000ae507208831d1518a15bc4e6.png" alt="Ravan">
        </div>

        <h2>RAVAN</h2>
        <p>Web Developer | Beat Maker</p>

        <div class="social-links">
            <a href="https://www.instagram.com/ch_akash_111?igsh=a2V2YnI1cXpkMzdu" class="btn insta">Instagram</a>
            <a href="https://youtube.com/@akash_yt517?si=Ti5bpQwMO5Klh4wx" class="btn yt">YouTube</a>
        </div>

        <div class="music-section">
            <audio id="myBeat" preload="auto">
                <source src="https://files.catbox.moe/qgnhtv.mp3" type="audio/mpeg">
            </audio>
            <button onclick="toggleMusic()" class="btn music-btn" id="pBtn">Play Beat üéµ</button>
        </div>

        <div class="about-section">
            <p>üëã Main abhi <b>Web Development</b> aur <b>Music</b> seekh raha hoon. Ye meri pehli website hai jo maine mobile par banayi hai!</p>
        </div>
    </div>
   <div class="bpm-container">
     <h2 class="neon-text">‚ö° BPM Real-Time Detector</h2>
     <p>Apna track upload karo aur magic dekho!</p>
    
    <div class="upload-area" id="drop-zone">
        <input type="file" id="audio-file" accept="audio/*" hidden>
        <label for="audio-file" class="upload-btn">üìÅ Choose Audio File</label>
    </div>

    <div id="loader" class="loader" style="display: none;">Analyzing Beats... ü•Å</div>
    
    <div class="result-box">
        <span id="bpm-value">--</span>
        <span class="label">BPM</span>
    </div>
   </div>
    <script>
      var song = document.getElementById("myBeat");
      var pBtn = document.getElementById("pBtn");
      var card = document.querySelector(".card");

      // Page khulte hi loading shuru kar do taaki music ready rahe
      song.load();

      function toggleMusic() {
        // Agar net slow hai aur file load nahi hui
        if (song.readyState === 0) {
          pBtn.innerHTML = "Connecting... üõ∞Ô∏è";
          return;
        }

        if (song.paused) {
          pBtn.innerHTML = "Loading... ‚è≥";
          song.play().then(() => {
            pBtn.innerHTML = "Pause Beat ‚è∏Ô∏è";
            card.classList.add("playing"); // Isse pulse animation chalu hogi
          }).catch(err => {
            alert("Bhai, pehle screen par kahin touch karo, phir play dabao!");
          });
        } else {
          song.pause();
          pBtn.innerHTML = "Play Beat üéµ";
          card.classList.remove("playing"); // Animation band
            <canvas id="visualizer"></canvas>
        }
      }
        // --- BPM DETECTOR LOGIC ---
document.getElementById('audio-file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const bpmDisplay = document.getElementById('bpm-value');
    const loader = document.getElementById('loader');
    
    loader.style.display = 'block'; // Loading dikhao
    bpmDisplay.innerText = '--';

    const reader = new FileReader();
    reader.onload = function(event) {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        audioContext.decodeAudioData(event.target.result, function(buffer) {
            // Offline context for fast processing
            const offlineContext = new OfflineAudioContext(1, buffer.length, buffer.sampleRate);
            const source = offlineContext.createBufferSource();
            source.buffer = buffer;

            // Low-pass filter to catch the kicks/bass
            const filter = offlineContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 150; 

            source.connect(filter);
            filter.connect(offlineContext.destination);
            source.start(0);

            offlineContext.startRendering().then(function(renderedBuffer) {
                // Yahan hum peaks calculate kar rahe hain
                const data = renderedBuffer.getChannelData(0);
                let peaks = [];
                for (let i = 0; i < data.length; i += 441) { 
                    if (data[i] > 0.8) peaks.push(i);
                }

                let intervals = [];
                for (let i = 1; i < peaks.length; i++) {
                    intervals.push(peaks[i] - peaks[i-1]);
                }

                const medianInterval = intervals.sort((a, b) => a - b)[Math.floor(intervals.length / 2)];
                let bpm = (60 * buffer.sampleRate) / medianInterval;
                
                // Normalizing (Trap/Hip-hop range)
                while (bpm < 70) bpm *= 2;
                while (bpm > 180) bpm /= 2;

                bpmDisplay.innerText = Math.round(bpm);
                loader.style.display = 'none'; // Loading band
            });
        });
    };
    reader.readAsArrayBuffer(file);
});
      </script>
    let audioCtx, source, analyser, canvas, ctx, bufferLength, dataArray;

function startVisualizer() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        // Tera audio element "myBeat" hai
        const audioEle = document.getElementById('myBeat');
        source = audioCtx.createMediaElementSource(audioEle);
        source.connect(analyser);
        analyser.connect(audioCtx.destination);
    }

    analyser.fftSize = 64; // Bars ki sankhya (kam rakhoge toh moti bars banengi)
    bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);

    canvas = document.getElementById('visualizer');
    ctx = canvas.getContext('2d');

    draw();
}

function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    let barWidth = (canvas.width / bufferLength) * 2.5;
    let barHeight;
    let x = 0;

    for (let i = 0; i < bufferLength; i++) {
        barHeight = dataArray[i] / 2;

        // Color theme: Neon Green to Purple
        ctx.fillStyle = `rgb(0, 255, 204)`; 
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

        x += barWidth + 1;
    }
}
        
</body>
</html>
